## Кредитный скоринг – классификация заемщиков по кредитному статусу

### Описание кейса
Когда клиент обращается в банк с заявлением о предоставлении кредита, банк принимает решение о выдаче кредита или об отказе в предоставлении кредита с использованием статистических моделей на основании информации о тех клиентах, которые уже брали кредит (кто-то из них выполнил свои обязательства по кредитному договору, а кто-то не выполнил). 
На вероятность возврата кредита может влиять много факторов, причем сложным образом, и для прогнозирования результатов по каждому отдельному случаю необходимо построить модель машинного обучения, которая на основании данных из заявления о выдаче кредита предсказывает, вернет ли заемщик этот кредит.

### Цель работы
Построение модели машинного обучения по предсказанию кредитного дефолта

### Задачи работы
1. Разведочный анализ данных
2. Предобработка данных
   - заполнение пропусков
   - удаление дублей и выбросов
   - нормализация и стандартизация
3. Генерация новых признаков
4. Отбор статистически значимых признаков
5. Построение моделей машинного обучения (метрика – [Accuracy](https://www.kaggle.com/c/findata-creditscoring/overview/evaluation))
   - интерпретируемые алгоритмы (логистическая регрессия, случайный лес)
   - другие модели 
   - нейронные сети
6. Оценка качества модели
7. Загрузка результатов на Kaggle
   
### Данные

#### Источник данных 
Бессрочное учебное соревнование на [Kaggle](https://www.kaggle.com/c/findata-creditscoring/)

#### Датасеты
* [тренировочный набор данных credit_train.csv](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit_train.csv), предназначенный для обучения модели, включающий 100000 записей о кредитах, относительно каждого из которых известно значение признака "Loan Status" - "Fully Paid" (погашен полностью) или "Charged Off" (не погашен).
* [тестовый набор данных credit_test.csv](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit_test.csv), условно разделенный на две части:
   - публичная часть, содержащая 5000 записей о кредитах (участникам соревнования недоступна информация о значении признака "Loan Status");
   - закрытая часть, содержащая 5000 записей о кредитах; вычисление (участникам соревнования недоступна информация о значении признака "Loan Status").

### Условия
Участник соревнования должен загрузить на платформу чемпионата файл с прогнозами по 10000 кредитам, данные по которым представлены в файле [credit_test.csv](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit_test.csv), половина из этих кредитов относится к публичному тестовому набору данных, другая половина - к закрытому тестовому набору данных.
Итоговый результат представляется в виде файла в формате csv, содержащем два столбца: "Loan ID" и "Loan Status": Loan ID, Loan Status. Пример результатов представлен в файле [credit__sample.csv](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit__sample.csv).

### Дополнительная информация
Набор данных [credit_train.csv](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit_train.csv) содержит ряд особенностей, включая пропущенные значения, дублирующиеся строки, выбросы и т. п. При построении модели машинного обучения целесообразно попробовать создать новые синтетические факторные признаки, являющиеся функциями от исходных факторов, преобразовать типы данных исходных факторов и т.п.

### Этапы работы

1. [Разведочный анализ данных](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit-scoring-eda.ipynb)
2. Machine Learning
   - [Выбор модели и гиперпараметров](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit-scoring-automl.ipynb)
   - [Тонкая настройка гиперпараметров](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/rf-hyperparameters-fine-tuning.ipynb)
3. [Deep Learning](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit-scoring-neural-network.ipynb)
4. [Оценка качества оптимальной модели](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit-scoring-results.ipynb)

### Выводы
#### [EDA](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit-scoring-eda.ipynb)
- В тренировочном датасете выявлены полные дубликаты в данных.
- Показано, что наблюдается невысокая степень несбалансированности классов (приблизительно 1 : 3).
- Множество значений таких признаков как "Кредитный рейтинг", "Годовой доход", "Стаж на текущем месте работы" и "Количество месяцев с последнего нарушения условий кредита" не заполнены.
- Такие атрибуты как "Размер кредита", "Кредитный рейтиг", "Годовой доход", "Суммарный текущий долг" и "Максимальный кредитный лимит из всех источников", содержат выбросы.
- С помощью статистических методов оценена значимость признаков. Показано, что среди числовых признаков самыми значимыми являеются кредитный рейтинг и размер кредита, а среди категориальных - срок кредита.
- Между некоторыми признаками выявлена линейная корреляция Пирсона с коэффициентом, достигающим 0.8. Наблюдаемые линейные статистические взаимосвязи не противоречат бизнес-смыслу коррелирующих показателей.

#### Machine Learning
- Реализована [библиотека](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit-scoring-automl.ipynb), автоматизирующая последовательные части конвейера машинного обучения:
   - заполнение пропусков в данных
   - кодирование категориальных переменных
   - масштабирование числовых переменных
   - подбор признаков
   - выбор модели
   - настройку гиперпараметров.
- Методом случайного решетчатого поиска с кросс-валидацией выбраны оптимальные гиперпараметры машинного обучения:
   - без масштабирования числовых признаков
   - алгоритм заполнения пропусков - медиана
   - количество выбранных для обучения модели признаков - 41 шт.
   - алгоритм ML - "случайный лес"
   - количество деревьев - 275 шт.
   - критерий информативности - Джини.
- Обучение указанной модели ML позволило достичь Accuracy, составляющей более 0.8
- [Тонкая настройка гиперпараметров](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/rf-hyperparameters-fine-tuning.ipynb) не привела к улучшению результата.
- Многочисленные эксперименты по предварительному удалению выбросов из данных, генерации новых признаков, приведению непрерывных переменных к распределению, близкому к нормальному, понижению размерности признакового пространства и т.п. также не привели к улучшению метрики.

#### [Deep Learning](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit-scoring-neural-network.ipynb)
- На тренировочных данных обучен многослоевой [перцептрон](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit-scoring-neural-network.ipynb)
- Построен пайплайн, включающий заполнение пустых значений признаков, one-hot-кодирование категориальных признаков и стандартизацию числовых признаков, отбор значимых признаков и непосредственно обучение модели.
- Подбор гиперпараметров осуществлен с помощью случайного решетчатого поиска с кросс-валидацией на 5 фолдах.
- Значение метрики не превзошло достигнутого ранее результата с помощью "случайного леса".

#### [Оценка качества модели](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/credit-scoring-results.ipynb)
Оценены метрики качества модели, которые, наряду с Accuracy, также имеют значение для бизнеса:
- F1-мера - 0.88
- Recall - 0.99
- Specificity: 0.24
- Precision: 0.79
- Ошибка I рода: 0.76
- Ошибка II рода: 0.0097

#### Результаты на [Kaggle](https://www.kaggle.com/c/findata-creditscoring/leaderboard) 
(по состоянию на 05.06.2021, nickname - Evgeniy Grinkin):
- загруженный датасет [здесь](https://github.com/egrinkin/SKILLFACTORY_RDS/blob/main/thesis_project/RF.csv)
- Accuracy - 0.82266 
- TOP 7%
- 17 место из 269